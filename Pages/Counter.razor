@page "/counter"

@implements IDisposable

@using blazor_experiment.Data
@inject AssetService AssetService

<h1>Counter</h1>

<p>Current count: @currentCount</p>

<button class="btn btn-primary" @onclick="IncrementCount">Click me</button>

<VirtualList Items="@assets" TItem="Asset">
    <RowTemplate>
        <div class="thumbnail-container">
            <p>@context.Path</p>
            <img src="/api/asset/thumbnail/@context.Guid" />
        </div>
    </RowTemplate>
</VirtualList>

@code {

    Asset[] assets;

    protected override async Task OnInitializedAsync()
    {
        assets = await AssetService.GetAssets();
        AssetService.Changed += AssetService_Changed;
    }

    protected override void OnParametersSet()
    {
        //for (int i = 0; i < 1000; i++)
        //    Rows.Add(new Row { PetId = $"{i.ToString()}", Name = $"{i.ToString()}" });
    }

    int currentCount = 0;

    void IncrementCount()
    {
        currentCount++;
    }

    private void AssetService_Changed(object sender, EventArgs e)
    {
        this.InvokeAsync(async () =>
        {
            assets = await AssetService.GetAssets();
            base.StateHasChanged();
        });
    }

    public void Dispose()
    {
        AssetService.Changed -= AssetService_Changed;
    }
}
